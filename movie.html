<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Watch Now2</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta8LxfdQfSnsiYVSCgKxIcnWZhprMofGnghRVlXv3rE5XQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="icon" type="image/png" href="https://i.postimg.cc/y82NzNVh/favicon-32x32.png">
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0HKCKP1FME"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0HKCKP1FME');
</script>
    <style>
      *,.search-box{box-sizing:border-box}#splash,body{background-color:#000}#search-button,#splash,body{font-family:Nunito,sans-serif;color:#fff}.background,.overlay{top:0;left:0;width:100%}body{margin:3px}.header-desktop{display:flex;align-items:center;justify-content:space-between;max-width:1200px;margin:20px auto 0;padding:0 20px}.site-name{font-size:2rem;font-weight:700;margin-top:5px;padding-left:1rem}.site-name a{color:#fff;text-decoration:none;transition:color .3s}.site-name a:hover{color:#0ff}.search-box{max-width:600px;width:100%;margin:0 auto;padding:10px;flex-grow:1}.search-controls{display:flex;flex-wrap:wrap;gap:10px}#category-toggle,#search-button,#search-input{min-width:0;box-sizing:border-box}#category-toggle{padding:.6rem;border-radius:8px;background:#222;color:#fff;border:1px solid #555}#search-input{flex:1;padding:.6rem 1rem;border-radius:8px;border:1px solid #555;background-color:#111;color:#fff}#search-results{background-color:#222;color:#fff;border-radius:5px;margin-top:5px;max-height:300px;overflow-y:auto}.search-result-item{padding:10px;border-bottom:1px solid #444;cursor:pointer}.search-result-item:hover{background-color:#333}#search-button{padding:.6rem 1.2rem;border-radius:12px;border:none;background-color:#0ff;cursor:pointer;transition:.3s;font-weight:600;box-shadow:0 2px 8px rgba(0,255,255,.5)}#search-button:hover{background-color:rgba(0,255,255,.8);transform:scale(1.05)}.spinner{border:8px solid #333;border-top:8px solid #0ff;border-radius:50%;width:60px;height:60px;animation:1s linear infinite spin;margin:50px auto}#splash,.background,.overlay,.side-menu{height:100%;position:fixed}#splash{z-index:9999;width:100%;display:flex;align-items:center;justify-content:center;font-size:2rem;flex-direction:column;animation:.3s ease-in-out fadeIn}@keyframes fadeOut{to{opacity:0;visibility:hidden}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.background{background-position:center;background-size:cover;filter:blur(20px);z-index:-2}.overlay{background:rgba(0,0,0,.65);z-index:-1}.container{max-width:1200px;margin:auto;padding:2rem}.movie-header{display:flex;flex-wrap:wrap;align-items:flex-start;gap:2rem}#episodes,#seasons{gap:1rem;display:flex}.movie-info{margin-top:10px;flex:2;line-height:1.8;font-weight:300}.movie-info h1{font-weight:700;margin:0 0 .5rem;font-size:2.5rem}.desktop-only,.menu-overlay.show{display:block}.mobile-only{display:none}.menu-toggle{position:fixed;top:20px;right:10px;z-index:11000;font-size:1.8rem;color:#fff;background:0 0;border:none;cursor:pointer;display:none}.side-menu{top:0;right:-260px;width:250px;background-color:#111;color:#fff;padding:2rem 1rem;transition:right .3s;z-index:10000;box-shadow:-5px 0 15px rgba(0,0,0,.5)}.side-menu.open{right:0}.menu-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:9999}.browse-buttons,.menu-item:hover{background-color:#2a2a2a}.menu-header{font-size:18px;font-weight:700;margin-top:20px;margin-bottom:15px;color:#aaa;padding-left:10px}.menu-list{list-style:none;padding:0;margin:0}.menu-item{display:flex;align-items:center;padding:10px;color:#fff;text-decoration:none;font-size:16px;transition:background-color .2s;cursor:pointer;border-radius:4px}.menu-item i{margin-right:15px;width:20px;text-align:center;font-size:1.1rem;color:#fff}.browse-buttons{display:flex;margin-bottom:20px;border-radius:8px;padding:5px}.browse-button{flex:1;padding:10px 15px;border:none;background-color:transparent;color:#bbb;font-size:16px;cursor:pointer;border-radius:6px;transition:background-color .2s,color .2s}.browse-button.active{background-color:#0ff;color:#000;font-weight:700}.search-section-menu{display:flex;background-color:#2a2a2a;border-radius:8px;overflow:hidden;margin-top:15px}#menu-search-button,#menu-search-input{background-color:transparent;border:none;padding:10px 15px}#menu-search-input{flex:1;color:#fff;font-size:16px;outline:0}.menu-watermark{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);color:#292929;font-size:1em;font-weight:200;opacity:.5;z-index:1;pointer-events:none}#menu-search-button{cursor:pointer;position:relative;z-index:1}#menu-search-button i{color:#fff;font-size:1.2rem}.genres{margin:1rem 0 2rem}.genre-tag{display:inline-block;background-color:rgba(255,0,0,0);color:#fff;padding:.4rem 1rem;margin:.3rem .3rem 0 0;border-radius:999px;font-size:.9rem;border:2px solid #0ff}.episode-button,.season-button{background:rgba(255,255,255,.1);cursor:pointer;transition:border-color .3s,background-color .3s;white-space:nowrap;color:#fff}@media (max-width:600px){.search-box{margin:3px auto;padding:6px}.search-controls{flex-direction:column}#category-toggle,#search-button,#search-input{width:100%}.container{padding:.5rem}.movie-info h1{font-size:1.8rem;margin:0 0 .5rem}.genre-tag{font-size:.7rem;padding:.3rem .7rem}.genres{margin-bottom:1rem}}#seasons,.cast-section{margin-top:2rem;padding-bottom:1rem}.poster{flex:1}.poster img{width:90%;border-radius:12px}.cast-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:1rem}.cast-member{text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;overflow:hidden}.cast-member img{width:100%;border-radius:10px;height:140px;object-fit:cover}.cast-member p{margin-top:5px;font-size:.9rem;white-space:normal;overflow:hidden;text-overflow:ellipsis;max-height:2.4em;line-height:1.2}iframe{margin-top:3rem;width:100%;height:500px;border:none;border-radius:12px}#seasons{overflow-x:auto;scrollbar-width:thin}.season-button{border:2px solid transparent;border-radius:12px;padding:.6rem 1.2rem;font-weight:600}.episode-button.active,.season-button.active{border-color:#0ff;background-color:rgba(0,255,255,.3);color:#fff}#episodes{margin-top:1rem;flex-wrap:wrap}.episode-button{border:2px solid transparent;border-radius:10px;padding:.5rem 1rem;font-size:.9rem}@media (max-width:768px){.desktop-only{display:none!important}.mobile-only{display:block!important}.menu-toggle{display:block}.header-desktop,.poster{display:none}.movie-header{flex-direction:column}.background{filter:blur(8px)}.cast-grid{grid-template-columns:repeat(4,1fr);gap:.5rem;overflow:hidden;scrollbar-width:none;-ms-overflow-style:none}.cast-grid::-webkit-scrollbar{display:none}.cast-member img{max-width:85px;height:110px;border-radius:8px}.cast-member p{font-size:clamp(.4rem, 1vw + .2rem, .6rem);margin-top:3px}}
    </style>

</head>
<body>

     <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>

    <div class="header-desktop desktop-only">
        <div class="site-name"><a href="index">Mooov</a></div>
        <div class="search-box">
            <div class="search-controls">
                <input type="text" id="search-input" placeholder="Search for a movie or TV show..." />
                <select id="category-toggle">
                    <option value="movie">Movies</option>
                    <option value="tv">TV Shows</option>
                </select>
                <button id="search-button">Search</button>
            </div>
        </div>
    </div>

    <nav id="sideMenu" class="side-menu mobile-only">
        <div class="menu-header">Menu</div>
        <ul class="menu-list">
            <li><a href="index" class="menu-item"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="movies" class="menu-item"><i class="fas fa-film"></i> Movies</a></li>
            <li><a href="tvshows" class="menu-item"><i class="fas fa-tv"></i> Tv Series</a></li>
        </ul>

        <div class="menu-header">Browse</div>
        <div class="browse-buttons">
            <button class="browse-button active" data-category="movie"></i> Movies</button>
            <button class="browse-button" data-category="tv"></i> TV Shows</button>
        </div>

        <div class="search-section-menu">
            <input type="search" id="menu-search-input" placeholder="Browse Movies" />
            <button id="menu-search-button"><i class="aresp search-resp"></i></button>
        </div>
        <div class="menu-watermark">S H E H A N J</div>
    </nav>

    <div id="menuOverlay" class="menu-overlay" onclick="toggleMenu()"></div>

    <div id="splash">
        <div>üçøüé¨ Loading...</div>
    </div>

    <div class="background" id="bg-blur"></div>
    <div class="overlay"></div>

    <div class="container">
        <div class="movie-header">
            <div class="movie-info">
                <h1 id="title">Loading...</h1>
                <div id="runtime"></div>
                <div class="genres" id="genres"></div>
                <p id="overview"></p>
                <div class="cast-section" id="cast-section" style="display:none;">
                    <h2>Top Cast</h2>
                    <div class="cast-grid" id="cast"></div>
                </div>
            </div>
            <div class="poster">
                <img id="poster" src="" alt="Poster" />
            </div>
        </div>

        <div id="seasons" style="display:none;"></div>
        <div id="episodes" style="display:none;"></div>

        <div id="player"></div>
    </div>

    <script>
         /**
         * Decodes HTML entities in a string.
         * @param {string} html - The HTML string to decode.
         * @returns {string} The decoded plain text.
         */
        function decodeHTML(html) {
            const txt = document.createElement("textarea");
            txt.innerHTML = html;
            return txt.value;
        }

        // Get ID and type from URL parameters
        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");
        const type = params.get("type"); // "movie" or "tv"

        let seasonsData = []; // Stores TV show seasons data
        let currentSeason = null; // Tracks the currently selected season
        let currentEpisode = null; // Tracks the currently selected episode

        /**
         * Loads and displays movie/TV show details from the API.
         */
        async function loadDetails() {
            try {
                // Fetch details from the Cloudflare Worker API
                const res = await fetch(`https://getdetails.mooov.online/details?id=${id}&type=${type}`);
                const data = await res.json();

                // Set title & year
                const title = data.title || data.name || "Untitled";
                const year = data.releaseYear || '';
                let fullTitle = decodeHTML(title);
                if (year) {
                    fullTitle += ` (${year})`;
                }
                document.getElementById("title").textContent = fullTitle;

                // Set overview
                document.getElementById("overview").textContent = decodeHTML(data.overview || "");

                // Set runtime (if available)
                document.getElementById("runtime").textContent = data.runtime ? `Runtime: ${data.runtime}` : "";

                // Set poster and background blur image
                const posterUrl = data.poster || "";
                document.getElementById("poster").src = posterUrl;
                document.getElementById("bg-blur").style.backgroundImage = posterUrl ? `url('${posterUrl}')` : "none";

                // Render genres
                const genreContainer = document.getElementById("genres");
                genreContainer.innerHTML = "";
                if (Array.isArray(data.genres)) {
                    data.genres.forEach(genre => {
                        const tag = document.createElement("span");
                        tag.className = "genre-tag";
                        tag.textContent = decodeHTML(genre);
                        genreContainer.appendChild(tag);
                    });
                }

                // Render cast (only if available)
                const castSection = document.getElementById("cast-section");
                const castContainer = document.getElementById("cast");

                if (Array.isArray(data.cast) && data.cast.length > 0) {
                    castContainer.innerHTML = "";
                    // Display up to 6 cast members
                    data.cast.slice(0, 4).forEach(person => {
                        const div = document.createElement("div");
                        div.className = "cast-member";
                        div.innerHTML = `
                            <img src="${person.image || 'https://i.postimg.cc/d15mp6sz/Image-Not-Available.jpg'}" alt="${person.name}" />
                            <div>${decodeHTML(person.name)}</div>
                        `;
                        castContainer.appendChild(div);
                    });
                    castSection.style.display = "block"; // Show cast section
                } else {
                    castSection.style.display = "none"; // Hide cast section if no cast
                }

                // Handle TV show specific logic (seasons and episodes)
                if (type === "tv") {
                    seasonsData = data.seasons || [];
                    if (seasonsData.length === 0) {
                        // Hide season/episode selectors if no seasons
                        document.getElementById("seasons").style.display = "none";
                        document.getElementById("episodes").style.display = "none";
                    } else {
                        renderSeasons(seasonsData);
                        // Automatically select the first season and its first episode
                        selectSeason(seasonsData[0].sn_num);
                    }
                } else if (type === "movie") {
                    // For movies, hide season/episode selectors and directly embed the player
                    document.getElementById("seasons").style.display = "none";
                    document.getElementById("episodes").style.display = "none";
                    renderPlayer(id, null, null); // Season and episode are null for movies
                }

                // Hide splash screen with a fade-out animation
                document.getElementById("splash").style.animation = "fadeOut 1s forwards";
                setTimeout(() => {
                    document.getElementById("splash").style.display = "none";
                }, 1000);

            } catch (err) {
                console.error("Failed to load details:", err);
                // Display a user-friendly message instead of alert()
                document.getElementById("splash").innerHTML = `
                    <div style="color: red; text-align: center;">
                        Failed to load details. Please try again later.
                        <br><br>
                        <button onclick="window.location.reload()" style="padding: 10px 20px; background-color: #00ffff; color: black; border: none; border-radius: 8px; cursor: pointer;">Reload</button>
                    </div>
                `;
                document.getElementById("splash").style.display = "flex"; // Keep splash visible with error
                document.getElementById("splash").style.animation = "none"; // Stop fade out
            }
        }

        /**
         * Renders season buttons for a TV show.
         * @param {Array} seasons - An array of season objects.
         */
        function renderSeasons(seasons) {
            const seasonsContainer = document.getElementById("seasons");
            seasonsContainer.style.display = "flex"; // Show seasons container
            seasonsContainer.innerHTML = ""; // Clear existing buttons
            seasons.forEach(season => {
                const btn = document.createElement("button");
                btn.textContent = `Season ${season.sn_num}`;
                btn.className = "season-button";
                btn.onclick = () => selectSeason(season.sn_num);
                btn.id = `season-btn-${season.sn_num}`; // Unique ID for highlighting
                seasonsContainer.appendChild(btn);
            });
        }

        /**
         * Selects a season and renders its episodes.
         * @param {number} seasonNumber - The number of the season to select.
         */
        function selectSeason(seasonNumber) {
            currentSeason = seasonsData.find(s => s.sn_num === seasonNumber);
            if (!currentSeason) return;

            // Remove 'active' class from all season buttons
            document.querySelectorAll(".season-button").forEach(btn => btn.classList.remove("active"));
            // Add 'active' class to the selected season button
            const activeBtn = document.getElementById(`season-btn-${seasonNumber}`);
            if (activeBtn) activeBtn.classList.add("active");

            renderEpisodes(currentSeason.episodes || []);
            // Auto select the first episode in the season if available
            if (currentSeason.episodes && currentSeason.episodes.length > 0) {
                selectEpisode(currentSeason.episodes[0].ep_number);
            } else {
                // If no episodes in the selected season, clear the player
                renderPlayer(null, null, null);
            }
        }

        /**
         * Renders episode buttons for a selected season.
         * @param {Array} episodes - An array of episode objects.
         */
        function renderEpisodes(episodes) {
            const episodesContainer = document.getElementById("episodes");
            episodesContainer.style.display = "flex"; // Show episodes container
            episodesContainer.innerHTML = ""; // Clear existing buttons
            episodes.forEach(ep => {
                const btn = document.createElement("button");
                btn.textContent = `Episode ${ep.ep_number}`;
                btn.className = "episode-button";
                btn.id = `episode-btn-${ep.ep_number}`; // Unique ID for highlighting
                btn.onclick = () => selectEpisode(ep.ep_number);
                episodesContainer.appendChild(btn);
            });
        }

        /**
         * Selects an episode and embeds the video player.
         * @param {number} episodeNumber - The number of the episode to select.
         */
        function selectEpisode(episodeNumber) {
            if (!currentSeason) return; // Ensure a season is selected
            currentEpisode = currentSeason.episodes.find(ep => ep.ep_number === episodeNumber);
            if (!currentEpisode) return;

            // Remove 'active' class from all episode buttons
            document.querySelectorAll(".episode-button").forEach(btn => btn.classList.remove("active"));
            // Add 'active' class to the selected episode button
            const activeBtn = document.getElementById(`episode-btn-${episodeNumber}`);
            if (activeBtn) activeBtn.classList.add("active");

            renderPlayer(id, currentSeason.sn_num, episodeNumber);
        }

        /**
         * Renders the video player iframe.
         * @param {string} mediaId - The ID of the movie/TV show.
         * @param {number|null} season - The season number (null for movies).
         * @param {number|null} episode - The episode number (null for movies).
         */
        function renderPlayer(mediaId, season, episode) {
            const playerContainer = document.getElementById("player");
            let src;
            if (type === "movie") {
                // Movie player iframe URL format
                src = `https://player.videasy.net/movie/${mediaId}`;
            } else if (type === "tv" && season && episode) {
                // TV show player iframe URL format
                src = `https://player.videasy.net/tv/${mediaId}/${season}/${episode}`;
            } else {
                // Display message if no player is available (e.g., missing season/episode for TV)
                playerContainer.innerHTML = "<p style='text-align: center; margin-top: 3rem;'>No player available for this selection.</p>";
                return;
            }
            playerContainer.innerHTML = `
                <iframe
                    src="${src}"
                    allowfullscreen
                    allow="autoplay; encrypted-media"
                    loading="lazy"
                    referrerpolicy="no-referrer"
                ></iframe>
            `;
        }

        /**
         * Toggles the visibility of the side menu and its overlay.
         */
        function toggleMenu() {
            const sideMenu = document.getElementById('sideMenu');
            const menuOverlay = document.getElementById('menuOverlay');
            const isOpen = sideMenu.classList.toggle('open');
            if (isOpen) {
                menuOverlay.classList.add('show');
            } else {
                menuOverlay.classList.remove('show');
            }
        }

        // --- New JavaScript for the Side Menu functionality ---

        // Get references to browse buttons and menu search elements
        const browseButtons = document.querySelectorAll('.browse-button');
        const menuSearchInput = document.getElementById('menu-search-input');
        const menuSearchButton = document.getElementById('menu-search-button');

        // Add event listeners to "Browse" buttons within the side menu
        browseButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove 'active' class from all browse buttons
                browseButtons.forEach(btn => btn.classList.remove('active'));
                // Add 'active' class to the clicked button
                button.classList.add('active');
                
                // Update the placeholder text of the menu search input based on selected category
                const selectedCategory = button.dataset.category;
                menuSearchInput.placeholder = `Browse ${selectedCategory === 'movie' ? 'Movies' : 'TV Shows'}`;
            });
        });

        // Handle search from the menu's browse section
        if (menuSearchButton) {
            menuSearchButton.addEventListener('click', () => {
                const query = menuSearchInput.value.trim();
                const activeBrowseButton = document.querySelector('.browse-button.active');
                // Determine the category based on the active browse button, default to 'movie'
                const category = activeBrowseButton ? activeBrowseButton.dataset.category : 'movie'; 

                if (query) {
                    // Redirect to search.html with query and category
                    window.location.href = `search?query=${encodeURIComponent(query)}&category=${category}`; //removed.html
                    toggleMenu(); // Close the menu after initiating search
                }
            });

            // Allow Enter key to trigger search in the side menu input
            menuSearchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    menuSearchButton.click(); // Simulate a click on the search button
                }
            });
        }

        // Set initial active state for browse buttons and search input placeholder on page load
        document.addEventListener('DOMContentLoaded', () => {
            const initialCategory = new URLSearchParams(window.location.search).get('category') || 'movie';
            const activeButton = document.querySelector(`.browse-button[data-category="${initialCategory}"]`);
            if (activeButton) {
                activeButton.classList.add('active');
                menuSearchInput.placeholder = `Browse ${initialCategory === 'movie' ? 'Movies' : 'TV Shows'}`;
            }
        });


        // --- Existing JavaScript for the main desktop search ---
// Get references to the desktop search elements
const searchInput = document.getElementById("search-input");
const searchButton = document.getElementById("search-button");

searchButton.addEventListener("click", () => {
    const query = searchInput.value.trim();
    const category = document.getElementById("category-toggle").value;

    if (query) {
        // Redirect to search.html with query and category in URL
        window.location.href = `search?query=${encodeURIComponent(query)}&category=${category}`; //removed .html
    }
});

// Allow Enter key to search for the desktop search input
searchInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        searchButton.click(); // Simulate a click on the search button
    }
});

        // Load the details once the DOM is fully loaded
        window.onload = loadDetails;

  
  
    </script>
</body>
</html>
